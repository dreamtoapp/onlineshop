import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function reRegisterPushSubscription() {
  try {
    console.log('ğŸ”„ Re-registering push subscription with new VAPID keys...\n');
    
    const testUserId = '6875122cc0fd0da262911f02'; // Ø§Ù…ÙˆØ§Ø¬ user
    
    // Check current subscription
    const currentSubscription = await prisma.pushSubscription.findUnique({
      where: { userId: testUserId }
    });

    if (currentSubscription) {
      console.log('ğŸ“± Current subscription found:');
      console.log(`   Endpoint: ${currentSubscription.endpoint}`);
      console.log(`   Created: ${currentSubscription.createdAt}`);
      
      // Delete old subscription
      console.log('\nğŸ—‘ï¸ Deleting old subscription...');
      await prisma.pushSubscription.delete({
        where: { userId: testUserId }
      });
      console.log('âœ… Old subscription deleted');
    } else {
      console.log('âŒ No existing subscription found');
    }

    console.log('\nğŸ“‹ Next Steps:');
    console.log('1. Go to your browser');
    console.log('2. Navigate to the dashboard');
    console.log('3. Look for the notification permission check component');
    console.log('4. Click "ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª" (Enable Notifications)');
    console.log('5. This will create a new subscription with the correct VAPID keys');
    console.log('\nğŸ¯ After re-registering, test the notification system again!');

  } catch (error) {
    console.error('âŒ Error:', error);
  } finally {
    await prisma.$disconnect();
  }
}

reRegisterPushSubscription(); 